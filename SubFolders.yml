# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  #vmImage: ubuntu-latest
  vmImage: windows-2022

variables:
- name: UiPath.CLI.Windows.22.10.8467.18097
  value: CLI\UiPath.CLI.Windows.22.10.8467.18097\tools\uipcli.exe

- name: UiPath.CLI.Windows.23.2.8467.25277
  value: CLI\UiPath.CLI.Windows.23.2.8467.25277\tools\uipcli.exe

- name: UiPath.CLI.Windows.23.6.0-dev
  value: CLI\UiPath.CLI.Windows.23.6.0-dev\tools\uipcli.exe

- name: UiPath.CLI.21.10.8319.10920
  value: CLI\UiPath.CLI.21.10.8319.10920\lib\net461\uipcli.exe

- name: UiPath.CLI.22.10.8467.18097
  value: CLI\UiPath.CLI.22.10.8467.18097\tools\uipcli.exe

- name: UiPath.CLI.23.2.8467.25277
  value: CLI\UiPath.CLI.23.2.8467.25277\tools\uipcli.exe

- name: UiPath.CLI.Windows.23.6.0-dev
  value: CLI\UiPath.CLI.Windows.23.6.0-dev\tools\uipcli.exe

- name: Staging_Orchestrator_Addresse
  value: https://staging.uipath.com

- name: Staging_Orchestrator_Folder
  value: UAT Non Production/CBK Processes Non Production

- name: Staging_Orchestrator_Tenant
  value: DefaultTenant

- name: Staging_Orchestrator_Organization
  value: testsuite

- name: Staging_Orchestrator_AppId
  value: f77ad440-af8b-491c-a93a-d907e8a7fc69

- name: Staging_Orchestrator_AppSecret
  value: S(N?g@M?lfUV3@Ts

- name: Application_Scopes
  value: OR.Monitoring OR.Folders OR.BackgroundTasks OR.TestSets OR.TestSetExecutions OR.TestSetSchedules OR.Settings OR.Robots OR.Machines OR.Execution OR.Assets OR.Users OR.Jobs


steps:

- task: PowerShell@2
  displayName: 'Run Tests in Subfolders'
  continueOnError: true
  inputs:
    targetType: 'inline'
    script: |
      $(Build.SourcesDirectory)\$(UiPath.CLI.Windows.23.6.0-dev) test run "$(Staging_Orchestrator_Addresse)" "$(Staging_Orchestrator_Tenant)" -s uipath_devops_Tests --accountForApp "$(Staging_Orchestrator_Organization)" --applicationId "$(Staging_Orchestrator_AppId)" --applicationSecret "$(Staging_Orchestrator_AppSecret)" --applicationScope "$(Application_Scopes)"  -o "$(Staging_Orchestrator_Folder)"  --traceLevel "Verbose" 



